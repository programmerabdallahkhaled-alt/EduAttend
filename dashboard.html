<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EduAttend Dashboard</title>
  <!--
    Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ù‡ÙŠÙƒÙ„ (HTML) ÙÙ‚Ø·.
    Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø³ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù€ CSS ÙˆØ§Ù„Ù€ JavaScript ÙˆÙŠÙØ±Ø³Ù„ Ø­Ø§Ù„Ø§Ù‹ Ø¨Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡.
  -->
</head>
<body>

  <!-- Ø²Ø± ÙØªØ­/Ù‚ÙÙ„ Ø§Ù„Ù€ Sidebar (ÙŠØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) -->
  <div class="menu-toggle" onclick="toggleSidebar()" aria-hidden="true">â˜°</div>

  <!-- ========== SIDEBAR ========== -->
  <aside class="sidebar" role="navigation" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
    <div class="brand">EduAttend</div>

    <nav class="menu" aria-label="Ù‚Ø§Ø¦Ù…Ø©">
      <!-- Ø§Ø³ØªØ®Ø¯Ù…Øª Ø£Ø²Ø±Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø±ÙˆØ§Ø¨Ø· Ù„ØªØ³Ù‡ÙŠÙ„ Ø±Ø¨Ø·Ù‡Ù… Ø¨Ø§Ù„Ù€ JS Ù„Ø§Ø­Ù‚Ø§Ù‹ -->
      <button id="studentsBtn" type="button">Ø§Ù„Ø·Ù„Ø§Ø¨</button>
      <button id="lessonsBtn"  type="button">Ø§Ù„Ø­ØµØµ</button>
      <button id="logoutBtn"   type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </nav>
  </aside>

  <!-- ========== MAIN CONTENT ========== -->
  <main class="content" role="main">
    <!-- ======== Students Section ======== -->
    <section id="students" class="page" aria-labelledby="studentsTitle" hidden>
      <div class="box">
        <h2 id="studentsTitle" class="title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>

        <!-- Filter Buttons -->
        <div class="filter-container" role="tablist" aria-label="ÙÙ„ØªØ± Ø§Ù„Ù…Ø±Ø§Ø­Ù„">
          <button class="tabBtn active" data-level="all" type="button">Ø§Ù„ÙƒÙ„</button>
          <button class="tabBtn" data-level="first" type="button">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</button>
          <button class="tabBtn" data-level="second" type="button">Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</button>
          <button class="tabBtn" data-level="third" type="button">Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</button>
        </div>

        <!-- Add Student Form -->
        <div class="box inner-box" aria-label="Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨">
          <h3 style="color:#2a4ea3; margin-bottom:12px;">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>

          <form id="addStudentForm" onsubmit="return false;" novalidate>
            <div class="form-grid">
              <input id="studentName" class="student-input" name="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" required />
              <input id="studentCode" class="student-input" name="code" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
              <select id="studentLevel" class="student-input" name="level" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø­Ù„Ø©">
                <option value="first">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="second">Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="third">Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</option>
              </select>
              <button id="addStudentBtn" class="add-btn" type="button">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
            </div>
          </form>
        </div>

        <!-- Students List -->
        <div class="box inner-box" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨">
          <h3 style="color:#2a4ea3; margin-bottom:12px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>

          <div class="table-wrapper" aria-live="polite">
            <table id="studentsTable" class="responsive-table" role="table" aria-label="Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨">
              <thead>
                <tr>
                  <th scope="col">Ø§Ù„Ø§Ø³Ù…</th>
                  <th scope="col">Ø§Ù„ÙƒÙˆØ¯</th>
                  <th scope="col">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                  <th scope="col">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody id="studentsList">
                <!-- ØµÙÙˆÙ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø³ØªÙ…ØªÙ„Ø¦ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù€ JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ======== Lessons Section ======== -->
    <section id="lessons" class="page" aria-labelledby="lessonsTitle" hidden>
      <div class="box">
        <h2 id="lessonsTitle" class="title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ØµØµ</h2>

        <!-- Add Lesson Form -->
        <div class="box inner-box" aria-label="Ø¥Ø¶Ø§ÙØ© Ø­ØµØ©">
          <form id="addLessonForm" onsubmit="return false;" novalidate>
            <div class="form-grid">
              <input id="lessonTitle" class="student-input" name="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­ØµØ©" required />
              <input id="lessonDate"  class="student-input" name="date" type="date" />
              <select id="lessonLevel" class="student-input" name="level">
                <option value="first">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="second">Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="third">Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</option>
              </select>
              <button id="addLessonBtn" class="add-btn" type="button">Ø¥Ø¶Ø§ÙØ© Ø­ØµØ©</button>
            </div>
          </form>
        </div>

        <!-- Lessons List -->
        <div class="box inner-box">
          <h3 style="color:#2a4ea3; margin-bottom:12px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­ØµØµ</h3>
          <div id="lessonsList" class="list-grid">
            <!-- ÙƒØ±ÙˆØª Ø§Ù„Ø­ØµØµ Ø³ØªÙÙˆÙ„Ø¯ Ø¨Ø§Ù„Ù€ JS -->
          </div>
        </div>
      </div>
    </section>

    <!-- ======== Welcome / Home ======== -->
    <section id="welcome" class="page" aria-labelledby="welcomeTitle">
      <div class="box">
        <h2 id="welcomeTitle" class="title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ğŸ‰</h2>
        <p>Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„Ø¨Ø¯Ø¡.</p>
      </div>
    </section>
  </main>

<!-- ========== PART 2: CSS + JavaScript (Responsive + Functional) ========== -->
<style>
/* ----------------- Layout & Basics ----------------- */
:root{
  --primary-500: #2a4ea3;
  --primary-600: #1b3b73;
  --accent1: linear-gradient(135deg,#538bff,#2a4ea3);
  --card-bg: #ffffff;
  --muted: #6d6d6d;
  --surface: #f6f9ff;
}

*{box-sizing:border-box}
body{font-family:"Tajawal", "Poppins", sans-serif; background:linear-gradient(135deg,#e8f0ff,#f6f9ff); margin:0; min-height:100vh; color:#0f2140}

/* Sidebar */
.sidebar{width:260px;background:#f0f6ff;border-right:1px solid #d8e7ff;padding:22px;display:flex;flex-direction:column;gap:18px;position:fixed;left:0;top:0;height:100%;transition:.28s;z-index:120;border-radius:0 12px 12px 0}
.brand{font-weight:700;color:var(--primary-500);font-size:20px;text-align:center}
.menu{display:flex;flex-direction:column;gap:12px}
.menu button{background:#eef4ff;border:0;padding:12px 14px;border-radius:12px;color:var(--primary-600);cursor:pointer;font-size:15px;transition:.18s}
.menu button:hover{transform:translateX(-6px);box-shadow:0 6px 18px rgba(42,78,163,0.08)}

/* Menu toggle (mobile) */
.menu-toggle{display:none;position:fixed;top:14px;right:16px;background:var(--primary-500);color:#fff;padding:10px;border-radius:10px;z-index:130;cursor:pointer}

/* Content area */
.content{margin-left:260px;padding:26px;transition:.28s}
.box{background:var(--card-bg);padding:18px;border-radius:14px;box-shadow:0 8px 28px rgba(16,32,80,0.06);margin-bottom:18px}
.title{font-size:22px;color:var(--primary-600);margin-bottom:12px}

/* Filter pills */
.filter-container{display:flex;gap:10px;flex-wrap:wrap}
.tabBtn{padding:10px 16px;border-radius:999px;border:1px solid #dbe8ff;background:#fff;color:var(--primary-500);cursor:pointer;box-shadow:0 2px 8px rgba(12,34,80,0.04)}
.tabBtn.active{background:var(--accent1);color:#fff;border:0;box-shadow:0 8px 22px rgba(42,78,163,0.16)}

/* Form grid */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-grid .student-input{width:100%;padding:10px;border-radius:10px;border:1px solid #e0e8ff}
.add-btn{grid-column:span 2;padding:10px;border-radius:10px;border:0;background:var(--accent1);color:#fff;cursor:pointer;font-weight:600}

/* Table responsive wrapper */
.table-wrapper{overflow:auto}
.responsive-table{width:100%;border-collapse:collapse;min-width:600px}
.responsive-table th, .responsive-table td{padding:10px;text-align:center;border-bottom:1px solid #f1f6ff}

/* Lessons list grid */
.list-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.lesson-card{background:linear-gradient(180deg, #fff,#fbfdff);padding:12px;border-radius:12px;border:1px solid #eef6ff;cursor:pointer;box-shadow:0 6px 18px rgba(12,34,80,0.04)}
.lesson-card h4{margin:0 0 6px 0;color:var(--primary-600);font-size:16px}
.lesson-meta{font-size:13px;color:var(--muted)}

/* Attendance view */
.attendance-header{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:12px}
.att-list{display:flex;flex-direction:column;gap:8px}
.att-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:#fff;border:1px solid #f1f6ff}

/* Small helpers */
.btn-ghost{background:transparent;border:1px solid #dbe8ff;padding:8px 10px;border-radius:8px;cursor:pointer}
.btn-success{background:#28a745;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}

/* Responsive rules */
@media(max-width:1024px){
  .list-grid{grid-template-columns:repeat(2,1fr)}
  .form-grid{grid-template-columns:1fr}
  .add-btn{grid-column:span 1}
  .responsive-table{min-width:520px}
}

@media(max-width:768px){
  .sidebar{left:-280px}
  .sidebar.active{left:0}
  .menu-toggle{display:block}
  .content{margin-left:0;padding:16px}
  .list-grid{grid-template-columns:1fr}
  .responsive-table{min-width:100%}
  .title{font-size:20px}
  .form-grid{grid-template-columns:1fr}
  .brand{font-size:18px}
}

/* Very small phones */
@media(max-width:420px){
  .menu-toggle{font-size:18px;padding:8px}
  .title{font-size:18px}
  .tabBtn{padding:8px 12px;font-size:14px}
}
</style>

<script>
/* =================== Data (in-memory placeholders) ===================
   Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø³ØªØ­Ù„ Ù…Ø­Ù„Ù‡Ø§ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© / Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¥Ù„Ù‰ Firebase
   - students: Ù…ØµÙÙˆÙØ© Ø·Ù„Ø§Ø¨ {id,name,code,level}
   - lessons: Ù…ØµÙÙˆÙØ© Ø­ØµØµ {id,title,date,level,key}
   - attendance: ÙƒØ§Ø¦Ù† Ù…Ø®Ø²Ù† Ø¨Ù‡ Ø§Ù„Ø­Ø¶ÙˆØ± keyed by lesson.key -> [studentId,...]
*/
let students = [];
let lessons = [];
let attendance = {}; // { lessonKey: [ids] }

/* ------------------ Utilities ------------------ */
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));
const uid = () => Date.now() + Math.floor(Math.random()*900);

/* ------------------ Sidebar & navigation ------------------ */
function toggleSidebar(){ document.querySelector('.sidebar').classList.toggle('active'); }
function showPage(id){
  // hide pages
  $$('.page').forEach(p => p.hidden = true);
  // show target
  const el = document.getElementById(id);
  if(el) el.hidden = false;
  // hide welcome when first navigating
  $('#welcome').hidden = true;
  // scroll top
  window.scrollTo({top:0,behavior:'smooth'});
}

/* connect sidebar buttons */
$('#studentsBtn').addEventListener('click', ()=> showPage('students'));
$('#lessonsBtn').addEventListener('click', ()=> showPage('lessons'));
$('#logoutBtn').addEventListener('click', ()=> { alert('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ø¨Ø± Firebase Ù„Ø§Ø­Ù‚Ø§Ù‹'); });

/* ------------------ Students logic ------------------ */
/* render students table according to filter (level) */
function renderStudents(filter='all'){
  const tbody = $('#studentsList');
  tbody.innerHTML = '';
  const list = students.filter(s => filter==='all' || s.level===filter);
  if(list.length===0){
    tbody.innerHTML = `<tr><td colspan="4" style="padding:18px;color:${'#6d6d6d'}">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø¨Ø¹Ø¯</td></tr>`;
    return;
  }
  for(const s of list){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td data-label="Ø§Ù„Ø§Ø³Ù…">${escapeHtml(s.name)}</td>
      <td data-label="Ø§Ù„ÙƒÙˆØ¯">${escapeHtml(s.code||'-')}</td>
      <td data-label="Ø§Ù„Ù…Ø±Ø­Ù„Ø©">${translateLevel(s.level)}</td>
      <td data-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
        <button class="btn-ghost" onclick="openEditStudent(${s.id})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn-ghost" style="margin-inline-start:8px;background:#ff4d4d;color:#fff;border:0" onclick="deleteStudent(${s.id})">Ø­Ø°Ù</button>
      </td>
    `;
    tbody.appendChild(tr);
  }
}

/* add student */
$('#addStudentBtn').addEventListener('click', ()=>{
  const name = $('#studentName').value.trim();
  const code = $('#studentCode').value.trim();
  const level = $('#studentLevel').value;
  if(!name){ alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨'); return; }
  const s = { id: uid(), name, code, level };
  students.push(s);
  // reset
  $('#studentName').value=''; $('#studentCode').value=''; $('#studentLevel').value='first';
  renderStudents(currentFilter);
});

/* delete student */
function deleteStudent(id){
  if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')) return;
  students = students.filter(s => s.id !== id);
  // also remove from attendance records
  for(const k in attendance){
    attendance[k] = attendance[k].filter(x => x !== id);
  }
  renderStudents(currentFilter);
  renderAttendanceIfOpen();
}

/* edit student (simple prompt flow) */
function openEditStudent(id){
  const s = students.find(x=>x.id===id);
  if(!s) return;
  const newName = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:', s.name);
  if(newName===null) return;
  s.name = newName.trim() || s.name;
  renderStudents(currentFilter);
  renderAttendanceIfOpen();
}

/* helpers */
function translateLevel(l){
  return l==='first' ? 'Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ' : l==='second' ? 'Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ' : 'Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ';
}
function escapeHtml(str){ return String(str).replace(/[&<>"]/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m])); }

/* ------------------ Filters (pills) ------------------ */
let currentFilter = 'all';
$$('.tabBtn').forEach(btn=>{
  btn.addEventListener('click', (e)=>{
    $$('.tabBtn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const level = btn.dataset.level;
    currentFilter = level;
    renderStudents(level);
  });
});

/* ------------------ Lessons logic ------------------ */
/* generate lesson key: lesson_ + 11 digits */
function generateLessonKey(){
  let digits = '';
  for(let i=0;i<11;i++) digits += Math.floor(Math.random()*10);
  return 'lesson_' + digits;
}

/* add lesson */
$('#addLessonBtn').addEventListener('click', ()=>{
  const title = $('#lessonTitle').value.trim();
  const date = $('#lessonDate').value || null;
  const level = $('#lessonLevel').value;
  if(!title){ alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­ØµØ©'); return; }
  const l = { id: uid(), title, date, level, key: generateLessonKey() };
  lessons.unshift(l); // newest first
  $('#lessonTitle').value=''; $('#lessonDate').value=''; $('#lessonLevel').value='first';
  renderLessons();
});

/* render lessons */
function renderLessons(){
  const container = $('#lessonsList');
  container.innerHTML = '';
  if(lessons.length===0){
    container.innerHTML = `<div style="color:${'#6d6d6d'}">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ØµØµ Ø¨Ø¹Ø¯</div>`;
    return;
  }
  for(const l of lessons){
    const card = document.createElement('div');
    card.className = 'lesson-card';
    card.innerHTML = `
      <h4>${escapeHtml(l.title)}</h4>
      <div class="lesson-meta">${l.date ? l.date+' â€¢ ' : ''}${translateLevel(l.level)}</div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn-ghost" onclick="enterLesson('${l.key}')">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­ØµØ©</button>
        <button class="btn-ghost" style="margin-inline-start:auto" onclick="deleteLesson(${l.id})">Ø­Ø°Ù</button>
      </div>
    `;
    container.appendChild(card);
  }
}

/* delete lesson */
function deleteLesson(id){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø­ØµØ©ØŸ')) return;
  lessons = lessons.filter(x=>x.id !== id);
  renderLessons();
}

/* ------------------ Attendance view ------------------ */
/* When entering a lesson, show attendance UI listing students of same level */
let currentOpenLessonKey = null;
function enterLesson(lessonKey){
  // find lesson
  const lesson = lessons.find(x=>x.key===lessonKey);
  if(!lesson) { alert('Ø§Ù„Ø­ØµØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©'); return; }

  currentOpenLessonKey = lessonKey;

  // Build attendance UI inside lessons section (replace lessons list)
  const container = $('#lessons');
  // hide other inner boxes temporarily
  $$('#lessons .inner-box, #lessons .list-grid').forEach(el=>el.style.display='none');

  // create attendance panel (or update if exists)
  let attPanel = $('#attendancePanel');
  if(!attPanel){
    attPanel = document.createElement('div');
    attPanel.id = 'attendancePanel';
    attPanel.className = 'box inner-box';
    container.querySelector('.box').appendChild(attPanel);
  }

  // header
  attPanel.innerHTML = `
    <div class="attendance-header">
      <div>
        <strong>${escapeHtml(lesson.title)}</strong><br>
        <small class="lesson-meta">${lesson.date ? lesson.date+' â€¢ ' : ''}${translateLevel(lesson.level)} â€¢ Ø§Ù„Ù…ÙØªØ§Ø­: <code>${lesson.key}</code></small>
      </div>
      <div>
        <button class="btn-ghost" onclick="closeAttendance()">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
      </div>
    </div>
    <div class="att-list" id="attList"></div>
    <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end;">
      <button class="btn-success" onclick="saveAttendance()">Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
    </div>
  `;

  // list students of same level
  const listDiv = $('#attList');
  listDiv.innerHTML = '';
  const same = students.filter(s=>s.level === lesson.level);
  if(same.length===0){
    listDiv.innerHTML = `<div style="color:${'#6d6d6d'}">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</div>`;
    return;
  }

  // existing attendance for this lesson
  const present = attendance[lesson.key] || [];

  for(const s of same){
    const row = document.createElement('div');
    row.className = 'att-item';
    row.innerHTML = `
      <div>${escapeHtml(s.name)}</div>
      <div><input type="checkbox" data-id="${s.id}" ${present.includes(s.id) ? 'checked' : ''}></div>
    `;
    listDiv.appendChild(row);
  }

  // scroll to attendance
  attPanel.scrollIntoView({behavior:'smooth'});
}

/* save attendance */
function saveAttendance(){
  if(!currentOpenLessonKey) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ØµØ© Ù…ÙØªÙˆØ­Ø©');
  const boxes = Array.from(document.querySelectorAll('#attList input[type="checkbox"]'));
  const presentIds = boxes.filter(cb=>cb.checked).map(cb=>Number(cb.dataset.id));
  attendance[currentOpenLessonKey] = presentIds;
  alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
  closeAttendance();
}

/* close attendance panel and restore lessons UI */
function closeAttendance(){
  currentOpenLessonKey = null;
  const attPanel = $('#attendancePanel');
  if(attPanel) attPanel.remove();
  // show inner boxes
  $$('#lessons .inner-box').forEach(el=>el.style.display='block');
  renderLessons();
}

/* if attendance panel open and students changed, update list */
function renderAttendanceIfOpen(){
  if(!currentOpenLessonKey) return;
  const lesson = lessons.find(x=>x.key===currentOpenLessonKey);
  if(lesson) enterLesson(lesson.key);
}

/* ------------------ Init (demo) ------------------ */
/* Optional: seed demo data for testing */
(function initDemo(){
  // sample students
  students = [
    {id:uid(), name:'Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', code:'S001', level:'first'},
    {id:uid(), name:'Ù…Ø±ÙŠÙ… Ø­Ø³Ù†', code:'S002', level:'second'},
    {id:uid(), name:'Ø¹Ù„ÙŠ Ø³Ø¹ÙŠØ¯', code:'S003', level:'third'},
    {id:uid(), name:'Ø³Ø§Ø±Ø© Ù…Ø­Ù…ÙˆØ¯', code:'S004', level:'first'}
  ];
  // sample lesson
  lessons = [
    {id:uid(), title:'Ø­ØµÙ‘Ø© Ø¬Ø¨Ø±', date:'2025-11-01', level:'first', key:generateLessonKey()},
    {id:uid(), title:'Ø­ØµÙ‘Ø© ÙÙŠØ²ÙŠØ§Ø¡', date:'2025-11-03', level:'second', key:generateLessonKey()}
  ];
  renderStudents('all');
  renderLessons();
})();

/* ------------------ Accessibility: keyboard nav for menu toggle ------------------ */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){ // close sidebar on Esc (mobile)
    document.querySelector('.sidebar').classList.remove('active');
  }
});
</script>

</body>
</html>

