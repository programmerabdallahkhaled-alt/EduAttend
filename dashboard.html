<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EduAttend Dashboard</title>

  <!-- ================== CSS (Responsive & Professional) ================== -->
  <style>
  :root{
    --primary-500: #2a4ea3;
    --primary-600: #1b3b73;
    --accent1: linear-gradient(135deg,#538bff,#2a4ea3);
    --card-bg: #ffffff;
    --muted: #6d6d6d;
    --surface: #f6f9ff;
  }

  *{box-sizing:border-box}
  body{font-family:"Tajawal","Poppins",sans-serif;background:linear-gradient(135deg,#e8f0ff,#f6f9ff);margin:0;min-height:100vh;color:#0f2140}

  /* Sidebar */
  .sidebar{width:260px;background:#f0f6ff;border-right:1px solid #d8e7ff;padding:22px;display:flex;flex-direction:column;gap:18px;position:fixed;left:0;top:0;height:100%;transition:.28s;z-index:120;border-radius:0 12px 12px 0}
  .brand{font-weight:700;color:var(--primary-500);font-size:20px;text-align:center}
  .menu{display:flex;flex-direction:column;gap:12px}
  .menu button{background:#eef4ff;border:0;padding:12px 14px;border-radius:12px;color:var(--primary-600);cursor:pointer;font-size:15px;transition:.18s}
  .menu button:hover{transform:translateX(-6px);box-shadow:0 6px 18px rgba(42,78,163,0.08)}

  /* Menu toggle (mobile) */
  .menu-toggle{display:none;position:fixed;top:14px;right:16px;background:var(--primary-500);color:#fff;padding:10px;border-radius:10px;z-index:130;cursor:pointer}

  /* Content area */
  .content{margin-left:260px;padding:26px;transition:.28s}
  .box{background:var(--card-bg);padding:18px;border-radius:14px;box-shadow:0 8px 28px rgba(16,32,80,0.06);margin-bottom:18px}
  .title{font-size:22px;color:var(--primary-600);margin-bottom:12px}

  /* Filter pills */
  .filter-container{display:flex;gap:10px;flex-wrap:wrap}
  .tabBtn{padding:10px 16px;border-radius:999px;border:1px solid #dbe8ff;background:#fff;color:var(--primary-500);cursor:pointer;box-shadow:0 2px 8px rgba(12,34,80,0.04)}
  .tabBtn.active{background:var(--accent1);color:#fff;border:0;box-shadow:0 8px 22px rgba(42,78,163,0.16)}

  /* Form grid */
  .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .form-grid .student-input{width:100%;padding:10px;border-radius:10px;border:1px solid #e0e8ff}
  .add-btn{grid-column:span 2;padding:10px;border-radius:10px;border:0;background:var(--accent1);color:#fff;cursor:pointer;font-weight:600}

  /* Table responsive wrapper */
  .table-wrapper{overflow:auto}
  .responsive-table{width:100%;border-collapse:collapse;min-width:600px}
  .responsive-table th, .responsive-table td{padding:10px;text-align:center;border-bottom:1px solid #f1f6ff}

  /* Lessons list grid */
  .list-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .lesson-card{background:linear-gradient(180deg,#fff,#fbfdff);padding:12px;border-radius:12px;border:1px solid #eef6ff;cursor:pointer;box-shadow:0 6px 18px rgba(12,34,80,0.04)}
  .lesson-card h4{margin:0 0 6px 0;color:var(--primary-600);font-size:16px}
  .lesson-meta{font-size:13px;color:var(--muted)}

  /* Attendance view */
  .attendance-header{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:12px}
  .att-list{display:flex;flex-direction:column;gap:8px}
  .att-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:#fff;border:1px solid #f1f6ff}

  /* Small helpers */
  .btn-ghost{background:transparent;border:1px solid #dbe8ff;padding:8px 10px;border-radius:8px;cursor:pointer}
  .btn-success{background:#28a745;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}

  /* Responsive rules */
  @media(max-width:1024px){
    .list-grid{grid-template-columns:repeat(2,1fr)}
    .form-grid{grid-template-columns:1fr}
    .add-btn{grid-column:span 1}
    .responsive-table{min-width:520px}
  }

  @media(max-width:768px){
    .sidebar{left:-280px}
    .sidebar.active{left:0}
    .menu-toggle{display:block}
    .content{margin-left:0;padding:16px}
    .list-grid{grid-template-columns:1fr}
    .responsive-table{min-width:100%}
    .title{font-size:20px}
    .form-grid{grid-template-columns:1fr}
    .brand{font-size:18px}
  }

  @media(max-width:420px){
    .menu-toggle{font-size:18px;padding:8px}
    .title{font-size:18px}
    .tabBtn{padding:8px 12px;font-size:14px}
  }

  /* small table->card behavior for very small widths */
  @media (max-width:480px){
    .responsive-table thead{display:none}
    .responsive-table tr{display:block;margin-bottom:12px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
    .responsive-table td{display:flex;justify-content:space-between;padding:8px 0}
    .responsive-table td::before{content:attr(data-label);font-weight:700;color:var(--primary-500);margin-inline-end:8px}
  }
  </style>
  <!-- ================== end CSS ================== -->
</head>

<body>

  <!-- Ø²Ø± ÙØªØ­/Ù‚ÙÙ„ Ø§Ù„Ù€ Sidebar (ÙŠØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) -->
  <div class="menu-toggle" onclick="toggleSidebar()" aria-hidden="true">â˜°</div>

  <!-- ========== SIDEBAR ========== -->
  <aside class="sidebar" role="navigation" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
    <div class="brand">EduAttend</div>

    <nav class="menu" aria-label="Ù‚Ø§Ø¦Ù…Ø©">
      <button id="studentsBtn" type="button">Ø§Ù„Ø·Ù„Ø§Ø¨</button>
      <button id="lessonsBtn"  type="button">Ø§Ù„Ø­ØµØµ</button>
      <button id="logoutBtn"   type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </nav>
  </aside>

  <!-- ========== MAIN CONTENT ========== -->
  <main class="content" role="main">
    <!-- ======== Students Section ======== -->
    <section id="students" class="page" aria-labelledby="studentsTitle" hidden>
      <div class="box">
        <h2 id="studentsTitle" class="title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>

        <!-- Filter Buttons -->
        <div class="filter-container" role="tablist" aria-label="ÙÙ„ØªØ± Ø§Ù„Ù…Ø±Ø§Ø­Ù„">
          <button class="tabBtn active" data-level="all" type="button">Ø§Ù„ÙƒÙ„</button>
          <button class="tabBtn" data-level="first" type="button">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</button>
          <button class="tabBtn" data-level="second" type="button">Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</button>
          <button class="tabBtn" data-level="third" type="button">Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</button>
        </div>

        <!-- Add Student Form -->
        <div class="box inner-box" aria-label="Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨">
          <h3 style="color:#2a4ea3; margin-bottom:12px;">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>

          <form id="addStudentForm" onsubmit="return false;" novalidate>
            <div class="form-grid">
              <input id="studentName" class="student-input" name="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" required />
              <input id="studentCode" class="student-input" name="code" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
              <select id="studentLevel" class="student-input" name="level" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø­Ù„Ø©">
                <option value="first">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="second">Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="third">Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</option>
              </select>
              <button id="addStudentBtn" class="add-btn">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>

            </div>
          </form>
        </div>

        <!-- Students List -->
        <div class="box inner-box" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨">
          <h3 style="color:#2a4ea3; margin-bottom:12px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>

          <div class="table-wrapper" aria-live="polite">
            <table id="studentsTable" class="responsive-table" role="table" aria-label="Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨">
              <thead>
                <tr>
                  <th scope="col">Ø§Ù„Ø§Ø³Ù…</th>
                  <th scope="col">Ø§Ù„ÙƒÙˆØ¯</th>
                  <th scope="col">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                  <th scope="col">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody id="studentsList">
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ======== Lessons Section ======== -->
    <section id="lessons" class="page" aria-labelledby="lessonsTitle" hidden>
      <div class="box">
        <h2 id="lessonsTitle" class="title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ØµØµ</h2>

        <!-- Add Lesson Form -->
        <div class="box inner-box" aria-label="Ø¥Ø¶Ø§ÙØ© Ø­ØµØ©">
          <form id="addLessonForm" onsubmit="return false;" novalidate>
            <div class="form-grid">
              <input id="lessonTitle" class="student-input" name="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­ØµØ©" required />
              <input id="lessonDate"  class="student-input" name="date" type="date" />
              <select id="lessonLevel" class="student-input" name="level">
                <option value="first">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="second">Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="third">Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</option>
              </select>
              <button id="addLessonBtn" class="add-btn" type="button">Ø¥Ø¶Ø§ÙØ© Ø­ØµØ©</button>
            </div>
          </form>
        </div>

        <!-- Lessons List -->
        <div class="box inner-box">
          <h3 style="color:#2a4ea3; margin-bottom:12px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­ØµØµ</h3>
          <div id="lessonsList" class="list-grid"></div>
        </div>
      </div>
    </section>

    <!-- ======== Welcome / Home ======== -->
    <section id="welcome" class="page" aria-labelledby="welcomeTitle">
      <div class="box">
        <h2 id="welcomeTitle" class="title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ğŸ‰</h2>
        <p>Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„Ø¨Ø¯Ø¡.</p>
      </div>
    </section>
  </main>
<script type="module">
/* ============================
   ğŸ”¥ Firebase Import
============================ */

import {
  initializeApp
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";

import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  updateDoc,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

import {
  getAuth,
  signOut
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

/* ============================
   ğŸ”¥ Firebase Config
============================ */

const firebaseConfig = {
  apiKey: "AIzaSyADeo3Nc2lqGKtnr_UqfNEZB28aGUCQsrc",
  authDomain: "eduattend-90a3d.firebaseapp.com",
  projectId: "eduattend-90a3d",
  storageBucket: "eduattend-90a3d.firebasestorage.app",
  messagingSenderId: "1002840427136",
  appId: "1:1002840427136:web:9de92f16a4303c8f117465"
};

// Start Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();

/* ============================
   ğŸŒ Helpers
============================ */
const $  = (s)=>document.querySelector(s);
const $$ = (s)=>document.querySelectorAll(s);

function translateLevel(lvl){
  return lvl==="first" ? "Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ"
       : lvl==="second"? "Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ"
       : "Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ";
}

/* ============================
   ğŸ“Œ Sidebar Navigation
============================ */

function toggleSidebar(){
  $(".sidebar").classList.toggle("active");
}
window.toggleSidebar = toggleSidebar;

function showPage(id){
  $$(".page").forEach(p=>p.hidden=true);
  $("#"+id).hidden = false;
  $("#welcome").hidden = true;

  window.scrollTo({top:0,behavior:"smooth"});
}

/* Buttons */
$("#studentsBtn").onclick = ()=>showPage("students");
$("#lessonsBtn").onclick  = ()=>showPage("lessons");

$("#logoutBtn").onclick = ()=>{
  signOut(auth);
  alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
  location.href = "index.html";
};

/* ============================
   ğŸ‘¤ Students (Firestore CRUD)
============================ */

let currentStudents = [];
let filterLevel = "all";

async function loadStudents(){
  currentStudents = [];
  const snap = await getDocs(collection(db,"students"));
  snap.forEach(docu=>{
    currentStudents.push({id:docu.id, ...docu.data()});
  });
  renderStudents();
}

function renderStudents(){
  const list = $("#studentsList");
  list.innerHTML = "";

  const filtered = currentStudents.filter(s=> filterLevel==="all" || s.level===filterLevel);

  if(filtered.length===0){
    list.innerHTML = `<tr><td colspan="4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</td></tr>`;
    return;
  }

  filtered.forEach(s=>{
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td data-label="Ø§Ù„Ø§Ø³Ù…">${s.name}</td>
      <td data-label="Ø§Ù„ÙƒÙˆØ¯">${s.code || "-"}</td>
      <td data-label="Ø§Ù„Ù…Ø±Ø­Ù„Ø©">${translateLevel(s.level)}</td>
      <td data-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
        <button class="btn-ghost" onclick="editStudent('${s.id}','${s.name}','${s.code}','${s.level}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn-ghost" style="background:#ff4d4d;color:#fff;" onclick="deleteStudent('${s.id}')">Ø­Ø°Ù</button>
      </td>
    `;

    list.appendChild(tr);
  });
}

window.deleteStudent = async(id)=>{
  if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) return;

  await deleteDoc(doc(db,"students",id));
  await loadStudents();
};

window.editStudent = async(id,name,code,level)=>{
  const newName = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…:", name);
  if(newName===null) return;

  await updateDoc(doc(db,"students",id),{
    name: newName.trim() || name
  });

  loadStudents();
};

$("#addStudentBtn").onclick = async()=>{
  const name  = $("#studentName").value.trim();
  const code  = $("#studentCode").value.trim();
  const level = $("#studentLevel").value;

  if(name===""){
    alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨");
    return;
  }

  await addDoc(collection(db,"students"),{
    name, code, level,
    createdAt: Date.now()
  });

  $("#studentName").value = "";
  $("#studentCode").value = "";
  $("#studentLevel").value = "first";

  loadStudents();
};

/* Filter buttons */
$$(".tabBtn").forEach(btn=>{
  btn.onclick = ()=>{
    $$(".tabBtn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    filterLevel = btn.dataset.level;
    renderStudents();
  };
});

/* ============================
   ğŸ“˜ Lessons (Firestore)
============================ */

let currentLessons = [];

function generateLessonKey(){
  return "lesson_" + Math.floor(10000000000 + Math.random()*90000000000);
}

async function loadLessons(){
  currentLessons = [];

  const snap = await getDocs(collection(db,"lessons"));
  snap.forEach(docu=>{
    currentLessons.push({id:docu.id, ...docu.data()});
  });

  renderLessons();
}

function renderLessons(){
  const box = $("#lessonsList");
  box.innerHTML = "";

  if(currentLessons.length===0){
    box.innerHTML = `<p style="color:#777;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ØµØµ</p>`;
    return;
  }

  currentLessons.forEach(l=>{
    const card = document.createElement("div");
    card.className = "lesson-card";

    card.innerHTML = `
      <h4>${l.title}</h4>
      <div class="lesson-meta">Ø§Ù„ØªØ§Ø±ÙŠØ®: ${l.date}</div>
      <div class="lesson-meta">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${translateLevel(l.level)}</div>
      <div class="lesson-meta">Ø§Ù„Ù…ÙØªØ§Ø­: ${l.key}</div>
    `;

    box.appendChild(card);
  });
}

$("#addLessonBtn").onclick = async()=>{
  const title = $("#lessonTitle").value.trim();
  const date  = $("#lessonDate").value;
  const level = $("#lessonLevel").value;

  if(title===""){
    alert("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­ØµØ©");
    return;
  }

  const key = generateLessonKey();

  await addDoc(collection(db,"lessons"),{
    title, date, level, key,
    createdAt: Date.now()
  });

  $("#lessonTitle").value = "";
  $("#lessonDate").value = "";
  $("#lessonLevel").value="first";

  loadLessons();
};

/* ============================
   ğŸš€ Initial Load
============================ */

loadStudents();
loadLessons();

</script>
</body>
</html>
